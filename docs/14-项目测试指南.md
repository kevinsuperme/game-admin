# é¡¹ç›®æµ‹è¯•å®Œæ•´æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

æœ¬æ–‡æ¡£æä¾›äº†é¡¹ç›®æ‰€æœ‰æ¨¡å—çš„å®Œæ•´æµ‹è¯•æµç¨‹,ç¡®ä¿ç³»ç»ŸåŠŸèƒ½æ­£ç¡®ã€æ€§èƒ½ä¼˜è‰¯ã€å®‰å…¨å¯é ã€‚

## ğŸ¯ æµ‹è¯•ç›®æ ‡

1. âœ… éªŒè¯æ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸å·¥ä½œ
2. âœ… ç¡®ä¿è®¤è¯æˆæƒæœºåˆ¶å®‰å…¨å¯é 
3. âœ… éªŒè¯æ€§èƒ½æŒ‡æ ‡ç¬¦åˆè¦æ±‚
4. âœ… ä¿è¯ç”¨æˆ·ä½“éªŒæµç•…
5. âœ… ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§

---

## ç›®å½•

- [ç¬¬ä¸€éƒ¨åˆ†: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•](#ç¬¬ä¸€éƒ¨åˆ†-æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•)
  - [1. è®¤è¯ä¸æˆæƒæµ‹è¯•](#1-è®¤è¯ä¸æˆæƒæµ‹è¯•)
  - [2. ç”¨æˆ·ç®¡ç†æµ‹è¯•](#2-ç”¨æˆ·ç®¡ç†æµ‹è¯•)
  - [3. ç³»ç»Ÿç®¡ç†æµ‹è¯•](#3-ç³»ç»Ÿç®¡ç†æµ‹è¯•)
- [ç¬¬äºŒéƒ¨åˆ†: ç»„ä»¶æµ‹è¯•](#ç¬¬äºŒéƒ¨åˆ†-ç»„ä»¶æµ‹è¯•)
  - [4. åŸºç¡€ç»„ä»¶æµ‹è¯•](#4-åŸºç¡€ç»„ä»¶æµ‹è¯•)
  - [5. ä¸šåŠ¡ç»„ä»¶æµ‹è¯•](#5-ä¸šåŠ¡ç»„ä»¶æµ‹è¯•)
- [ç¬¬ä¸‰éƒ¨åˆ†: æ€§èƒ½ä¸å®‰å…¨æµ‹è¯•](#ç¬¬ä¸‰éƒ¨åˆ†-æ€§èƒ½ä¸å®‰å…¨æµ‹è¯•)
  - [6. æ€§èƒ½æµ‹è¯•](#6-æ€§èƒ½æµ‹è¯•)
  - [7. å®‰å…¨æµ‹è¯•](#7-å®‰å…¨æµ‹è¯•)
- [ç¬¬å››éƒ¨åˆ†: é›†æˆä¸ç«¯åˆ°ç«¯æµ‹è¯•](#ç¬¬å››éƒ¨åˆ†-é›†æˆä¸ç«¯åˆ°ç«¯æµ‹è¯•)
  - [8. é›†æˆæµ‹è¯•](#8-é›†æˆæµ‹è¯•)
  - [9. ç«¯åˆ°ç«¯æµ‹è¯•](#9-ç«¯åˆ°ç«¯æµ‹è¯•)
- [é™„å½•](#é™„å½•)
  - [A. æµ‹è¯•ç¯å¢ƒé…ç½®](#a-æµ‹è¯•ç¯å¢ƒé…ç½®)
  - [B. æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿](#b-æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿)
  - [C. å¸¸è§é—®é¢˜è§£å†³](#c-å¸¸è§é—®é¢˜è§£å†³)

---

# ç¬¬ä¸€éƒ¨åˆ†: æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

## 1. è®¤è¯ä¸æˆæƒæµ‹è¯•

### 1.1 Token ç®¡ç†æµ‹è¯•

#### 1.1.1 TokenService å•å…ƒæµ‹è¯•

åˆ›å»ºæµ‹è¯•æ–‡ä»¶: `src/domains/shared/services/__tests__/TokenService.spec.ts`

```typescript
import { describe, it, expect, beforeEach, afterEach, vi } from 'vitest'
import { tokenService } from '../TokenService'

describe('TokenService', () => {
  beforeEach(() => {
    tokenService.clearToken()
    sessionStorage.clear()
    vi.useFakeTimers()
  })

  afterEach(() => {
    vi.restoreAllMocks()
  })

  describe('åŸºç¡€åŠŸèƒ½', () => {
    it('åº”è¯¥èƒ½å­˜å‚¨å’Œè¯»å– access token', () => {
      const tokenData = {
        token: 'test-access-token',
        refreshToken: 'test-refresh-token',
      }

      tokenService.setToken(tokenData)

      expect(tokenService.getAccessToken()).toBe('test-access-token')
      expect(tokenService.getRefreshToken()).toBe('test-refresh-token')
    })

    it('åº”è¯¥èƒ½æ­£ç¡®åˆ¤æ–­ token æœ‰æ•ˆæ€§', () => {
      expect(tokenService.hasValidToken()).toBe(false)

      tokenService.setToken({
        token: 'test-token',
        expiresAt: Date.now() + 3600000,
      })

      expect(tokenService.hasValidToken()).toBe(true)
    })

    it('åº”è¯¥èƒ½æ¸…é™¤ token', () => {
      tokenService.setToken({ token: 'test-token' })
      expect(tokenService.hasValidToken()).toBe(true)

      tokenService.clearToken()
      
      expect(tokenService.hasValidToken()).toBe(false)
      expect(tokenService.getAccessToken()).toBeNull()
    })
  })

  describe('è¿‡æœŸå¤„ç†', () => {
    it('åº”è¯¥è‡ªåŠ¨æ¸…é™¤å·²è¿‡æœŸçš„ token', () => {
      tokenService.setToken({
        token: 'expired-token',
        expiresAt: Date.now() - 1000,
      })

      expect(tokenService.hasValidToken()).toBe(false)
      expect(tokenService.getAccessToken()).toBeNull()
    })

    it('åº”è¯¥èƒ½æ£€æµ‹å³å°†è¿‡æœŸçš„ token', () => {
      tokenService.setToken({
        token: 'expiring-token',
        expiresAt: Date.now() + 4 * 60 * 1000,
      })

      expect(tokenService.isTokenExpiringSoon()).toBe(true)
    })
  })

  describe('SessionStorage é›†æˆ', () => {
    it('åº”è¯¥å°† token å¤‡ä»½åˆ° sessionStorage', () => {
      tokenService.setToken({
        token: 'test-token',
        refreshToken: 'test-refresh',
      })

      const stored = sessionStorage.getItem('auth_session')
      expect(stored).not.toBeNull()
      
      const parsed = JSON.parse(stored!)
      expect(parsed.token).toBe('test-token')
    })

    it('æ¸…é™¤ token æ—¶åº”è¯¥åŒæ—¶æ¸…é™¤ sessionStorage', () => {
      tokenService.setToken({ token: 'test-token' })
      expect(sessionStorage.getItem('auth_session')).not.toBeNull()

      tokenService.clearToken()
      
      expect(sessionStorage.getItem('auth_session')).toBeNull()
    })
  })
})
```

**è¿è¡Œæµ‹è¯•:**
```bash
npm run test:unit -- TokenService.spec.ts
```

#### 1.1.2 Auth Store æµ‹è¯•

åˆ›å»ºæµ‹è¯•æ–‡ä»¶: `src/domains/auth/stores/__tests__/authStore.spec.ts`

```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useAuthStore } from '../authStore'
import { tokenService } from '@/domains/shared/services/TokenService'

vi.mock('../../services/authService', () => ({
  authService: {
    login: vi.fn(),
    refreshToken: vi.fn(),
    logout: vi.fn(),
  },
}))

describe('AuthStore', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
    tokenService.clearToken()
  })

  describe('ç™»å½•æµç¨‹', () => {
    it('æˆåŠŸç™»å½•åº”è¯¥ä¿å­˜ token å’Œç”¨æˆ·ä¿¡æ¯', async () => {
      const store = useAuthStore()
      const mockResponse = {
        user: { id: 1, account: 'testuser', permissions: [] },
        token: 'new-token',
        refreshToken: 'new-refresh',
        expiresAt: new Date(Date.now() + 3600000).toISOString(),
      }

      const { authService } = await import('../../services/authService')
      vi.mocked(authService.login).mockResolvedValue(mockResponse)

      await store.login({ account: 'testuser', password: 'password' })

      expect(store.isAuthenticated).toBe(true)
      expect(store.token).toBe('new-token')
      expect(tokenService.getAccessToken()).toBe('new-token')
    })
  })

  describe('ç™»å‡ºæµç¨‹', () => {
    it('åº”è¯¥æ¸…é™¤æ‰€æœ‰è®¤è¯çŠ¶æ€', async () => {
      const store = useAuthStore()
      
      tokenService.setToken({ token: 'test-token' })
      store.isAuthenticated = true

      await store.logout()

      expect(store.isAuthenticated).toBe(false)
      expect(tokenService.getAccessToken()).toBeNull()
    })
  })
})
```

### 1.2 ç™»å½•åŠŸèƒ½æµ‹è¯•

#### æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

**æ­¥éª¤ 1: æ­£å¸¸ç™»å½•**

1. è®¿é—® `http://localhost:5173/login`
2. è¾“å…¥è´¦å·: `admin`
3. è¾“å…¥å¯†ç : `admin123`
4. ç‚¹å‡»ç™»å½•

**éªŒè¯:**
```javascript
console.log('Token:', window.__tokenService?.getAccessToken())
console.log('SessionStorage:', sessionStorage.getItem('auth_session'))
```

**é¢„æœŸç»“æœ:**
- âœ… è·³è½¬åˆ°é¦–é¡µ
- âœ… Token å­˜å‚¨åœ¨å†…å­˜
- âœ… SessionStorage æœ‰å¤‡ä»½

**æ­¥éª¤ 2: é”™è¯¯å¤„ç†**

æµ‹è¯•åœºæ™¯:
- ç©ºè´¦å·/å¯†ç 
- é”™è¯¯çš„å‡­æ®
- ç½‘ç»œé”™è¯¯

**é¢„æœŸç»“æœ:**
- âœ… æ˜¾ç¤ºé€‚å½“çš„é”™è¯¯æç¤º
- âœ… ä¸å­˜å‚¨æ— æ•ˆ token
- âœ… è¡¨å•ä¿æŒå¯ç”¨

### 1.3 æƒé™æ§åˆ¶æµ‹è¯•

#### 1.3.1 è·¯ç”±æƒé™æµ‹è¯•

```typescript
// src/domains/auth/__tests__/permission.spec.ts
import { describe, it, expect, beforeEach } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { useAuthStore } from '../stores/authStore'
import { hasPermission } from '../utils/permission'

describe('æƒé™æ§åˆ¶', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('åº”è¯¥æ­£ç¡®éªŒè¯ç”¨æˆ·æƒé™', () => {
    const store = useAuthStore()
    store.user = {
      id: 1,
      account: 'testuser',
      permissions: ['user:read', 'user:write']
    }

    expect(hasPermission('user:read')).toBe(true)
    expect(hasPermission('user:delete')).toBe(false)
  })

  it('è¶…çº§ç®¡ç†å‘˜åº”è¯¥æ‹¥æœ‰æ‰€æœ‰æƒé™', () => {
    const store = useAuthStore()
    store.user = {
      id: 1,
      account: 'admin',
      permissions: ['*']
    }

    expect(hasPermission('any:permission')).toBe(true)
  })
})
```

#### 1.3.2 æ‰‹åŠ¨æµ‹è¯•

**æµ‹è¯•åœºæ™¯ 1: è®¿é—®å—ä¿æŠ¤çš„è·¯ç”±**

1. æœªç™»å½•çŠ¶æ€è®¿é—® `/system/security`
2. **é¢„æœŸ:** é‡å®šå‘åˆ°ç™»å½•é¡µ

**æµ‹è¯•åœºæ™¯ 2: æƒé™ä¸è¶³**

1. ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•
2. å°è¯•è®¿é—®ç®¡ç†å‘˜é¡µé¢
3. **é¢„æœŸ:** æ˜¾ç¤ºæƒé™ä¸è¶³æç¤º

---

## 2. ç”¨æˆ·ç®¡ç†æµ‹è¯•

### 2.1 ç”¨æˆ·åˆ—è¡¨æµ‹è¯•

#### 2.1.1 æ•°æ®åŠ è½½æµ‹è¯•

```typescript
// src/domains/user/__tests__/userList.spec.ts
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import UserList from '@/views/user/list.vue'

describe('ç”¨æˆ·åˆ—è¡¨', () => {
  it('åº”è¯¥èƒ½åŠ è½½ç”¨æˆ·åˆ—è¡¨', async () => {
    const mockUsers = [
      { id: 1, account: 'user1', name: 'User One' },
      { id: 2, account: 'user2', name: 'User Two' },
    ]

    vi.mock('@/domains/user/services/userService', () => ({
      userService: {
        getUsers: vi.fn().mockResolvedValue(mockUsers),
      },
    }))

    const wrapper = mount(UserList)
    await wrapper.vm.$nextTick()

    expect(wrapper.findAll('.user-item')).toHaveLength(2)
  })
})
```

#### 2.1.2 æ‰‹åŠ¨æµ‹è¯•

**æ­¥éª¤:**

1. è®¿é—®ç”¨æˆ·ç®¡ç†é¡µé¢
2. éªŒè¯ç”¨æˆ·åˆ—è¡¨æ˜¾ç¤º
3. æµ‹è¯•åˆ†é¡µåŠŸèƒ½
4. æµ‹è¯•æœç´¢åŠŸèƒ½
5. æµ‹è¯•ç­›é€‰åŠŸèƒ½

**é¢„æœŸç»“æœ:**
- âœ… ç”¨æˆ·åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- âœ… åˆ†é¡µåˆ‡æ¢æ­£å¸¸
- âœ… æœç´¢ç»“æœå‡†ç¡®
- âœ… ç­›é€‰åŠŸèƒ½æœ‰æ•ˆ

### 2.2 ç”¨æˆ·CRUDæµ‹è¯•

#### åˆ›å»ºç”¨æˆ·

```javascript
// æ§åˆ¶å°æµ‹è¯•
const newUser = {
  account: 'testuser',
  name: 'Test User',
  email: 'test@example.com',
  password: 'password123'
}

// è°ƒç”¨åˆ›å»ºæ¥å£
await userService.createUser(newUser)
```

**éªŒè¯:**
- âœ… ç”¨æˆ·æˆåŠŸåˆ›å»º
- âœ… åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°
- âœ… è¡¨å•é‡ç½®

#### ç¼–è¾‘ç”¨æˆ·

**æµ‹è¯•æ­¥éª¤:**
1. ç‚¹å‡»ç”¨æˆ·ç¼–è¾‘æŒ‰é’®
2. ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
3. ä¿å­˜æ›´æ”¹

**éªŒè¯:**
- âœ… æ•°æ®æ­£ç¡®ä¿å­˜
- âœ… åˆ—è¡¨æ›´æ–°
- âœ… æˆåŠŸæç¤º

#### åˆ é™¤ç”¨æˆ·

**æµ‹è¯•æ­¥éª¤:**
1. é€‰æ‹©ç”¨æˆ·
2. ç‚¹å‡»åˆ é™¤
3. ç¡®è®¤åˆ é™¤

**éªŒè¯:**
- âœ… ç”¨æˆ·è¢«åˆ é™¤
- âœ… åˆ—è¡¨æ›´æ–°
- âœ… æç¤ºæ­£ç¡®

---

## 3. ç³»ç»Ÿç®¡ç†æµ‹è¯•

### 3.1 ç³»ç»Ÿç›‘æ§æµ‹è¯•

åˆ›å»ºæµ‹è¯•æ–‡ä»¶: `src/domains/system/__tests__/monitoring.spec.ts`

```typescript
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Monitoring from '@/views/system/monitoring/index.vue'

describe('ç³»ç»Ÿç›‘æ§', () => {
  it('åº”è¯¥èƒ½æ˜¾ç¤ºç³»ç»ŸæŒ‡æ ‡', async () => {
    const wrapper = mount(Monitoring)
    await wrapper.vm.$nextTick()

    expect(wrapper.find('.cpu-usage').exists()).toBe(true)
    expect(wrapper.find('.memory-usage').exists()).toBe(true)
    expect(wrapper.find('.disk-usage').exists()).toBe(true)
  })

  it('åº”è¯¥èƒ½å®æ—¶æ›´æ–°æ•°æ®', async () => {
    vi.useFakeTimers()
    
    const wrapper = mount(Monitoring)
    const initialCpu = wrapper.vm.cpuUsage

    // ç­‰å¾…è‡ªåŠ¨åˆ·æ–°
    await vi.advanceTimersByTimeAsync(5000)

    const updatedCpu = wrapper.vm.cpuUsage
    expect(updatedCpu).not.toBe(initialCpu)

    vi.useRealTimers()
  })
})
```

### 3.2 ç³»ç»Ÿå®‰å…¨æµ‹è¯•

#### æ‰‹åŠ¨æµ‹è¯•

**åŠŸèƒ½æ¸…å•:**
- [ ] å®‰å…¨è®¾ç½®é¡µé¢åŠ è½½æ­£å¸¸
- [ ] å¯†ç ç­–ç•¥é…ç½®æœ‰æ•ˆ
- [ ] ç™»å½•é™åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] ä¼šè¯ç®¡ç†æ­£ç¡®
- [ ] æ“ä½œæ—¥å¿—è®°å½•å®Œæ•´

### 3.3 å¤‡ä»½æ¢å¤æµ‹è¯•

**æµ‹è¯•åœºæ™¯:**

1. **åˆ›å»ºå¤‡ä»½**
   - ç‚¹å‡»åˆ›å»ºå¤‡ä»½
   - éªŒè¯å¤‡ä»½æ–‡ä»¶ç”Ÿæˆ
   - æ£€æŸ¥å¤‡ä»½åˆ—è¡¨

2. **æ¢å¤å¤‡ä»½**
   - é€‰æ‹©å¤‡ä»½æ–‡ä»¶
   - æ‰§è¡Œæ¢å¤æ“ä½œ
   - éªŒè¯æ•°æ®æ¢å¤

3. **å®šæ—¶å¤‡ä»½**
   - é…ç½®å®šæ—¶ä»»åŠ¡
   - éªŒè¯è‡ªåŠ¨æ‰§è¡Œ
   - æ£€æŸ¥å¤‡ä»½ç»“æœ

### 3.4 ç³»ç»Ÿæ›´æ–°æµ‹è¯•

**æµ‹è¯•æ­¥éª¤:**

1. æ£€æŸ¥æ›´æ–°
2. ä¸‹è½½æ›´æ–°åŒ…
3. æ‰§è¡Œæ›´æ–°
4. éªŒè¯æ›´æ–°ç»“æœ
5. å›æ»šæµ‹è¯•

---

# ç¬¬äºŒéƒ¨åˆ†: ç»„ä»¶æµ‹è¯•

## 4. åŸºç¡€ç»„ä»¶æµ‹è¯•

### 4.1 è¡¨å•ç»„ä»¶æµ‹è¯•

#### Input ç»„ä»¶

```typescript
// src/components/__tests__/Input.spec.ts
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Input from '@/components/ui/input.vue'

describe('Input ç»„ä»¶', () => {
  it('åº”è¯¥èƒ½æ­£ç¡®æ˜¾ç¤ºåˆå§‹å€¼', () => {
    const wrapper = mount(Input, {
      props: { modelValue: 'test value' }
    })

    expect(wrapper.find('input').element.value).toBe('test value')
  })

  it('åº”è¯¥èƒ½è§¦å‘ update:modelValue äº‹ä»¶', async () => {
    const wrapper = mount(Input)
    const input = wrapper.find('input')

    await input.setValue('new value')

    expect(wrapper.emitted('update:modelValue')).toBeTruthy()
    expect(wrapper.emitted('update:modelValue')?.[0]).toEqual(['new value'])
  })

  it('åº”è¯¥æ”¯æŒç¦ç”¨çŠ¶æ€', () => {
    const wrapper = mount(Input, {
      props: { disabled: true }
    })

    expect(wrapper.find('input').attributes('disabled')).toBeDefined()
  })
})
```

#### Button ç»„ä»¶

```typescript
describe('Button ç»„ä»¶', () => {
  it('åº”è¯¥èƒ½æ­£ç¡®æ¸²æŸ“', () => {
    const wrapper = mount(Button, {
      slots: { default: 'Click Me' }
    })

    expect(wrapper.text()).toBe('Click Me')
  })

  it('åº”è¯¥èƒ½è§¦å‘ç‚¹å‡»äº‹ä»¶', async () => {
    const wrapper = mount(Button)
    
    await wrapper.trigger('click')

    expect(wrapper.emitted('click')).toBeTruthy()
  })

  it('ç¦ç”¨çŠ¶æ€ä¸åº”è§¦å‘ç‚¹å‡»', async () => {
    const wrapper = mount(Button, {
      props: { disabled: true }
    })

    await wrapper.trigger('click')

    expect(wrapper.emitted('click')).toBeFalsy()
  })
})
```

### 4.2 æ•°æ®å±•ç¤ºç»„ä»¶æµ‹è¯•

#### Table ç»„ä»¶

```typescript
describe('Table ç»„ä»¶', () => {
  const mockData = [
    { id: 1, name: 'Item 1', status: 'active' },
    { id: 2, name: 'Item 2', status: 'inactive' },
  ]

  it('åº”è¯¥èƒ½æ­£ç¡®æ¸²æŸ“æ•°æ®', () => {
    const wrapper = mount(Table, {
      props: {
        data: mockData,
        columns: [
          { key: 'id', title: 'ID' },
          { key: 'name', title: 'Name' },
        ]
      }
    })

    expect(wrapper.findAll('tbody tr')).toHaveLength(2)
  })

  it('åº”è¯¥æ”¯æŒæ’åºåŠŸèƒ½', async () => {
    const wrapper = mount(Table, {
      props: {
        data: mockData,
        columns: [
          { key: 'name', title: 'Name', sortable: true }
        ]
      }
    })

    const sortButton = wrapper.find('.sort-button')
    await sortButton.trigger('click')

    expect(wrapper.emitted('sort')).toBeTruthy()
  })
})
```

### 4.3 åé¦ˆç»„ä»¶æµ‹è¯•

#### Modal ç»„ä»¶

```typescript
describe('Modal ç»„ä»¶', () => {
  it('åº”è¯¥èƒ½æ§åˆ¶æ˜¾ç¤ºéšè—', async () => {
    const wrapper = mount(Modal, {
      props: { visible: false }
    })

    expect(wrapper.find('.modal').isVisible()).toBe(false)

    await wrapper.setProps({ visible: true })

    expect(wrapper.find('.modal').isVisible()).toBe(true)
  })

  it('åº”è¯¥èƒ½è§¦å‘å…³é—­äº‹ä»¶', async () => {
    const wrapper = mount(Modal, {
      props: { visible: true }
    })

    await wrapper.find('.close-button').trigger('click')

    expect(wrapper.emitted('close')).toBeTruthy()
  })
})
```

---

## 5. ä¸šåŠ¡ç»„ä»¶æµ‹è¯•

### 5.1 é¡µé¢å¤´éƒ¨æµ‹è¯•

```typescript
describe('PageHeader ç»„ä»¶', () => {
  it('åº”è¯¥æ˜¾ç¤ºæ ‡é¢˜å’Œé¢åŒ…å±‘', () => {
    const wrapper = mount(PageHeader, {
      props: {
        title: 'Test Page',
        breadcrumb: ['Home', 'Test']
      }
    })

    expect(wrapper.find('h1').text()).toBe('Test Page')
    expect(wrapper.findAll('.breadcrumb-item')).toHaveLength(2)
  })
})
```

### 5.2 æœç´¢æ æµ‹è¯•

```typescript
describe('SearchBar ç»„ä»¶', () => {
  it('åº”è¯¥èƒ½è§¦å‘æœç´¢äº‹ä»¶', async () => {
    const wrapper = mount(SearchBar)
    
    await wrapper.find('input').setValue('test query')
    await wrapper.find('form').trigger('submit')

    expect(wrapper.emitted('search')).toBeTruthy()
  })
})
```

---

# ç¬¬ä¸‰éƒ¨åˆ†: æ€§èƒ½ä¸å®‰å…¨æµ‹è¯•

## 6. æ€§èƒ½æµ‹è¯•

### 6.1 å“åº”æ—¶é—´æµ‹è¯•

```typescript
describe('æ€§èƒ½æµ‹è¯•', () => {
  it('Token æ“ä½œåº”è¯¥å¿«é€Ÿå®Œæˆ', () => {
    console.time('setToken')
    tokenService.setToken({ token: 'test', refreshToken: 'test' })
    console.timeEnd('setToken')
    // é¢„æœŸ: < 1ms

    console.time('getToken')
    tokenService.getAccessToken()
    console.timeEnd('getToken')
    // é¢„æœŸ: < 0.1ms
  })
})
```

### 6.2 å†…å­˜æ³„æ¼æµ‹è¯•

```javascript
// æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
console.log('Initial:', performance.memory?.usedJSHeapSize)

// æ‰§è¡Œå¤§é‡æ“ä½œ
for (let i = 0; i < 100; i++) {
  tokenService.setToken({ token: `test-${i}` })
  tokenService.clearToken()
}

console.log('After:', performance.memory?.usedJSHeapSize)
```

### 6.3 æ‰“åŒ…ä½“ç§¯æµ‹è¯•

```bash
npm run build
npm run build:analyze
```

**æ£€æŸ¥é¡¹:**
- âœ… æ€»ä½“ç§¯ < 500KB (gzip)
- âœ… ä¸»åŒ… < 200KB
- âœ… æ— é‡å¤ä¾èµ–

---

## 7. å®‰å…¨æµ‹è¯•

### 7.1 XSS é˜²æŠ¤æµ‹è¯•

**æµ‹è¯•åœºæ™¯:**

```javascript
// å°è¯•åœ¨è¾“å…¥æ¡†è¾“å…¥
const xssPayload = '<script>alert("XSS")</script>'
// é¢„æœŸ: è„šæœ¬è¢«è½¬ä¹‰,ä¸æ‰§è¡Œ
```

### 7.2 CSRF é˜²æŠ¤æµ‹è¯•

```javascript
// Token ä¸å­˜å‚¨åœ¨ Cookie
console.log('Cookies:', document.cookie)
// é¢„æœŸ: ä¸åŒ…å« token
```

### 7.3 æƒé™ç»•è¿‡æµ‹è¯•

```javascript
// æœªç™»å½•è®¿é—® API
fetch('/api/admin/users')
// é¢„æœŸ: 401 Unauthorized
```

---

# ç¬¬å››éƒ¨åˆ†: é›†æˆä¸ç«¯åˆ°ç«¯æµ‹è¯•

## 8. é›†æˆæµ‹è¯•

### 8.1 å®Œæ•´ç™»å½•æµç¨‹

```typescript
describe('è®¤è¯æµç¨‹é›†æˆæµ‹è¯•', () => {
  it('å®Œæ•´ç™»å½•æµç¨‹', async () => {
    // 1. æ¸²æŸ“ç™»å½•é¡µ
    // 2. è¾“å…¥å‡­æ®
    // 3. æäº¤ç™»å½•
    // 4. éªŒè¯ token å­˜å‚¨
    // 5. éªŒè¯ session å¤‡ä»½
    // 6. éªŒè¯è·¯ç”±è·³è½¬
  })
})
```

### 8.2 é¡µé¢åˆ·æ–°çŠ¶æ€æ¢å¤

```typescript
describe('é¡µé¢åˆ·æ–°çŠ¶æ€æ¢å¤', () => {
  it('åº”è¯¥ä» sessionStorage æ¢å¤è®¤è¯çŠ¶æ€', async () => {
    // 1. è®¾ç½®è®¤è¯çŠ¶æ€
    // 2. æ¨¡æ‹Ÿé¡µé¢åˆ·æ–°
    // 3. éªŒè¯çŠ¶æ€æ¢å¤
  })
})
```

---

## 9. ç«¯åˆ°ç«¯æµ‹è¯•

### 9.1 ç”¨æˆ·å®Œæ•´å·¥ä½œæµ

**åœºæ™¯: ç®¡ç†å‘˜ç®¡ç†ç”¨æˆ·**

1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥ç”¨æˆ·ç®¡ç†
3. åˆ›å»ºæ–°ç”¨æˆ·
4. ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
5. åˆ é™¤ç”¨æˆ·
6. ç™»å‡ºç³»ç»Ÿ

**æ¯æ­¥éªŒè¯:**
- é¡µé¢åŠ è½½æ­£å¸¸
- æ“ä½œæˆåŠŸæ‰§è¡Œ
- æ•°æ®æ­£ç¡®æ›´æ–°
- æç¤ºä¿¡æ¯å‡†ç¡®

---

# é™„å½•

## A. æµ‹è¯•ç¯å¢ƒé…ç½®

### å•å…ƒæµ‹è¯•é…ç½®

```typescript
// vitest.config.ts
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
    },
  },
})
```

### E2Eæµ‹è¯•é…ç½®

```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  use: {
    baseURL: 'http://localhost:5173',
    screenshot: 'only-on-failure',
  },
})
```

## B. æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¥æœŸ:** YYYY-MM-DD
**æµ‹è¯•äººå‘˜:** XXX
**æµ‹è¯•ç¯å¢ƒ:** å¼€å‘/æµ‹è¯•/ç”Ÿäº§

## æµ‹è¯•æ¦‚è¦

- è®¡åˆ’æµ‹è¯•: XX é¡¹
- å®é™…å®Œæˆ: XX é¡¹
- é€šè¿‡: XX é¡¹
- å¤±è´¥: XX é¡¹
- é˜»å¡: XX é¡¹

## è¯¦ç»†ç»“æœ

### 1. è®¤è¯æµ‹è¯•
- [âœ…] ç™»å½•åŠŸèƒ½
- [âœ…] ç™»å‡ºåŠŸèƒ½
- [âŒ] Token åˆ·æ–° - éœ€è¦ä¿®å¤

### 2. ç”¨æˆ·ç®¡ç†
- [âœ…] åˆ—è¡¨å±•ç¤º
- [âœ…] åˆ›å»ºç”¨æˆ·
- [âš ï¸] åˆ é™¤ç”¨æˆ· - æœ‰è­¦å‘Š

## é—®é¢˜åˆ—è¡¨

| ID | ä¸¥é‡ç¨‹åº¦ | æè¿° | çŠ¶æ€ |
|----|---------|------|------|
| 1  | é«˜      | Token åˆ·æ–°å¤±è´¥ | å¾…ä¿®å¤ |
| 2  | ä¸­      | åˆ é™¤æç¤ºä¸æ˜ç¡® | å¾…ä¼˜åŒ– |

## å»ºè®®

1. ä¿®å¤ Token åˆ·æ–°æœºåˆ¶
2. ä¼˜åŒ–ç”¨æˆ·äº¤äº’æç¤º
3. å¢åŠ é”™è¯¯æ—¥å¿—
```

## C. å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: æµ‹è¯•ç¯å¢ƒ Token è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ:**
```javascript
// ä½¿ç”¨å›ºå®šçš„æµ‹è¯• token
const TEST_TOKEN = 'test-token-' + Date.now()
tokenService.setToken({
  token: TEST_TOKEN,
  expiresAt: Date.now() + 24 * 3600000 // 24å°æ—¶
})
```

### é—®é¢˜2: Mock æ•°æ®ä¸ç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ:**
```typescript
// ç¡®ä¿ mock åœ¨æµ‹è¯•å‰å£°æ˜
vi.mock('@/api/user', () => ({
  getUsers: vi.fn().mockResolvedValue([...])
}))
```

### é—®é¢˜3: ç»„ä»¶æ¸²æŸ“å¤±è´¥

**è§£å†³æ–¹æ¡ˆ:**
```typescript
// æä¾›å¿…è¦çš„å…¨å±€ä¾èµ–
mount(Component, {
  global: {
    plugins: [createPinia(), router],
    stubs: {
      'router-link': true
    }
  }
})
```

---

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½ (å¿…æµ‹)

- [ ] ç™»å½•/ç™»å‡º
- [ ] Token ç®¡ç†
- [ ] æƒé™æ§åˆ¶
- [ ] ç”¨æˆ·ç®¡ç†
- [ ] ç³»ç»Ÿè®¾ç½®

### ç»„ä»¶åŠŸèƒ½ (é‡ç‚¹)

- [ ] åŸºç¡€ç»„ä»¶
- [ ] è¡¨å•éªŒè¯
- [ ] æ•°æ®å±•ç¤º
- [ ] äº¤äº’åé¦ˆ

### æ€§èƒ½æŒ‡æ ‡ (é‡è¦)

- [ ] å“åº”æ—¶é—´ < 200ms
- [ ] æ‰“åŒ…ä½“ç§¯ < 500KB
- [ ] é¦–å±åŠ è½½ < 2s

### å®‰å…¨éªŒè¯ (å…³é”®)

- [ ] XSS é˜²æŠ¤
- [ ] CSRF é˜²æŠ¤
- [ ] SQL æ³¨å…¥é˜²æŠ¤
- [ ] æƒé™ç»•è¿‡æµ‹è¯•

---

## ğŸ¯ æµ‹è¯•æ‰§è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œ E2E æµ‹è¯•
npm run test:e2e

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼
npm run test:watch
```

---

## ğŸ“ æµ‹è¯•æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç‹¬ç«‹æ€§:** æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ,ä¸ä¾èµ–å…¶ä»–æµ‹è¯•
2. **æ•°æ®æ¸…ç†:** æµ‹è¯•åæ¸…ç†æµ‹è¯•æ•°æ®,é¿å…æ±¡æŸ“
3. **Mock ä½¿ç”¨:** åˆç†ä½¿ç”¨ Mock,ä½†ä¸è¦è¿‡åº¦ Mock
4. **æ–­è¨€æ¸…æ™°:** æ–­è¨€åº”è¯¥æ¸…æ™°è¡¨è¾¾é¢„æœŸç»“æœ
5. **é”™è¯¯å¤„ç†:** æµ‹è¯•åº”è¯¥åŒ…å«é”™è¯¯åœºæ™¯
6. **æ€§èƒ½è€ƒè™‘:** é¿å…æµ‹è¯•æ‰§è¡Œæ—¶é—´è¿‡é•¿
7. **æ–‡æ¡£åŒæ­¥:** ä¿æŒæµ‹è¯•æ–‡æ¡£ä¸ä»£ç åŒæ­¥

---

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0  
**æœ€åæ›´æ–°:** 2025-10-25  
**ç»´æŠ¤è€…:** å¼€å‘å›¢é˜Ÿ