# Code Review 指南

## 概述

本文档定义了Fantastic-admin项目的代码审查标准和最佳实践，旨在确保代码质量、一致性和可维护性。

## 审查原则

### 1. 积极建设性
- 提供建设性反馈，专注于改进而非批评
- 认可代码中的优点和良好实践
- 保持尊重和专业的沟通方式

### 2. 全面性
- 检查功能正确性、性能、安全性和可维护性
- 确保代码符合项目编码规范
- 验证测试覆盖率和测试质量

### 3. 及时性
- 尽快响应审查请求，避免阻塞开发流程
- 对于大型变更，可分阶段进行审查

## 审查检查清单

### 代码质量

#### 功能性
- [ ] 代码实现了预期功能
- [ ] 边界条件和异常情况得到处理
- [ ] 逻辑清晰，易于理解

#### 类型安全（TypeScript）
- [ ] 正确使用TypeScript类型
- [ ] 避免使用`any`类型，除非必要
- [ ] 接口定义合理，类型准确
- [ ] 类型断言使用得当

#### 性能
- [ ] 没有明显的性能问题
- [ ] 避免不必要的计算和渲染
- [ ] 适当使用缓存和记忆化
- [ ] 资源使用合理（内存、CPU等）

#### 安全性
- [ ] 没有安全漏洞（XSS、CSRF等）
- [ ] 敏感信息得到适当保护
- [ ] 输入验证和清理充分
- [ ] 权限控制正确实现

### 代码风格

#### 一致性
- [ ] 遵循项目编码规范
- [ ] 命名一致且有意义
- [ ] 代码格式符合ESLint规则
- [ ] 注释风格一致

#### 可读性
- [ ] 代码结构清晰
- [ ] 函数和变量命名具有描述性
- [ ] 复杂逻辑有适当注释
- [ ] 避免过度复杂的嵌套

#### Vue组件
- [ ] 组件结构合理（template、script、style顺序）
- [ ] 组件命名遵循PascalCase
- [ ] Props和Emits定义完整
- [ ] 组件职责单一且明确

### 架构与设计

#### 组件设计
- [ ] 组件职责单一
- [ ] 组件间耦合度低
- [ ] 可复用性高
- [ ] 状态管理合理

#### 状态管理
- [ ] 状态存储位置合理（local、store、context）
- [ ] 状态变更逻辑清晰
- [ ] 避免不必要的状态提升
- [ ] 响应式数据使用得当

#### API设计
- [ ] API接口设计合理
- [ ] 错误处理完善
- [ ] 数据结构设计合理
- [ ] 接口文档完整

### 测试

#### 测试覆盖
- [ ] 关键功能有单元测试
- [ ] 复杂逻辑有测试覆盖
- [ ] 边界条件得到测试
- [ ] 错误处理有测试验证

#### 测试质量
- [ ] 测试用例有意义
- [ ] 测试描述清晰
- [ ] 测试数据合理
- [ ] 测试稳定可靠

## 审查流程

### 1. 提交前准备
- 开发者完成自检
- 确保代码通过所有自动化检查
- 提供清晰的PR描述和变更说明

### 2. 审查过程
- 审查者全面检查代码
- 提供具体、可操作的反馈
- 对于问题，建议解决方案
- 标记关键问题，需要修复后再合并

### 3. 反馈处理
- 开发者响应所有审查意见
- 解释设计决策（如有必要）
- 修复标记的问题
- 更新相关文档和测试

### 4. 批准与合并
- 所有关键问题得到解决
- 至少一名维护者批准
- 通过所有自动化检查
- 合并到目标分支

## 常见问题与建议

### 类型相关问题
```typescript
// 不推荐：使用any类型
const data: any = fetchData()

// 推荐：定义具体类型
interface UserData {
  id: number
  name: string
  email: string
}
const data: UserData = fetchData()
```

### Vue组件问题
```vue
<!-- 不推荐：过度复杂的模板 -->
<template>
  <div v-if="condition1">
    <span v-if="condition2">
      {{ nestedValue }}
    </span>
  </div>
</template>

<!-- 推荐：使用计算属性简化模板 -->
<template>
  <div v-if="displayValue">
    {{ displayValue }}
  </div>
</template>

<script setup lang="ts">
const displayValue = computed(() => {
  return condition1 && condition2 ? nestedValue : null
})
</script>
```

### 性能问题
```typescript
// 不推荐：在渲染函数中创建新对象
function MyComponent({ items }) {
  return (
    <ul>
      {items.map(item => (
        <li key={item.id} style={{ color: item.color }}>
          {item.name}
        </li>
      ))}
    </ul>
  )
}

// 推荐：使用CSS类或计算属性
function MyComponent({ items }) {
  return (
    <ul>
      {items.map(item => (
        <li key={item.id} className={item.colorClass}>
          {item.name}
        </li>
      ))}
    </ul>
  )
}
```

## 工具与资源

### 自动化工具
- **ESLint**: 代码风格和潜在问题检查
- **TypeScript**: 类型检查
- **Prettier**: 代码格式化
- **Stylelint**: CSS/SCSS代码检查
- **Husky**: Git钩子管理
- **lint-staged**: 暂存文件检查

### 有用的VS Code扩展
- Vue Language Features (Volar)
- TypeScript Vue Plugin (Volar)
- ESLint
- Prettier
- Stylelint
- GitLens

## 特殊情况处理

### 紧急修复
- 可以先合并，后续再完善
- 需要在PR中标记为紧急修复
- 必须添加回归测试

### 大型重构
- 分阶段进行审查
- 可以先审查架构设计
- 重点关注影响范围和兼容性

### 实验性功能
- 明确标记为实验性
- 代码隔离，易于移除
- 文档说明实验性质和限制

## 持续改进

### 定期回顾
- 定期审查和更新本指南
- 收集团队反馈，改进审查流程
- 分析常见问题，更新编码规范

### 知识分享
- 定期分享代码审查经验
- 讨论最佳实践和设计模式
- 培训新团队成员

---

如有疑问或建议，请随时在团队讨论中提出。